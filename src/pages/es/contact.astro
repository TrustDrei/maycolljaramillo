---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { CONTACT_CTA, SITE } from '../../config/site';
import { PERSON } from '../../config/person';
import { breadcrumbJsonLd } from '../../lib/seo';
import Icon from '../../components/Icon.astro';
import contactScript from '../../scripts/contact-form.ts?url';

const structuredData = [
  breadcrumbJsonLd([
    { name: 'Inicio', path: '/es' },
    { name: 'Contacto', path: '/es/contact' }
  ])
];

const formEndpoint = import.meta.env.PUBLIC_CONTACT_ENDPOINT || '/api/contact';
const formAccessKey = import.meta.env.PUBLIC_CONTACT_ACCESS_KEY ?? '';
---

<BaseLayout
  lang="es"
  title={`Contacto | ${PERSON.shortName}`}
  description="Contacto por WhatsApp o email para ingeniería de sistemas, automatización, SEO técnico, accesibilidad y plataformas enterprise."
  canonicalPath="/es/contact"
  alternates={[{ lang: 'en', path: '/en/contact' }]}
  structuredData={structuredData}
>
  <section class="mx-auto max-w-4xl px-4 py-12 md:px-6">
    <p class="text-xs uppercase tracking-[0.2em] text-accent">Contacto</p>
    <h1 class="mt-2 text-3xl font-semibold text-foreground">Revisemos tu stack y criterios técnicos</h1>
    <p class="mt-3 max-w-3xl text-muted">
      Respondo en menos de 24h hábiles. Una llamada breve ayuda a entender contexto, métricas actuales y prioridades antes de proponer alcance.
    </p>

    <div class="mt-6 flex flex-wrap gap-3">
      <a
        class="inline-flex items-center justify-center gap-2 rounded-full bg-accent px-4 py-2 text-sm font-semibold text-surface shadow-soft transition hover:bg-accent-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-surface"
        href={CONTACT_CTA.primary.href}
      >
        <Icon name="whatsapp" label="WhatsApp" />
        WhatsApp
      </a>
      <a
        class="inline-flex items-center justify-center rounded-full border border-border/70 bg-panel px-4 py-2 text-sm font-semibold text-foreground transition hover:border-accent hover:text-foreground focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent"
        href={`mailto:${SITE.email}?subject=Proyecto%20%2F%20Consultoria`}
      >
        Escribirme por email
      </a>
    </div>

    <div class="mt-8 card p-6">
      <p class="text-xs uppercase tracking-[0.12em] text-accent">Formulario</p>
      <p class="mt-2 text-muted">Si prefieres, deja tu contexto y te respondo en menos de 24h habiles.</p>
      <form
        class="mt-4 space-y-4"
        name="contact-es"
        method="POST"
        action={formEndpoint}
        data-form-handler="contact"
        data-form-lang="es"
        data-form-endpoint={formEndpoint}
      >
        <p class="visually-hidden">
          <label>Si eres humano, deja esto vacio <input name="bot-field" /></label>
        </p>
        <input type="hidden" name="locale" value="es" />
        {formAccessKey ? <input type="hidden" name="access_key" value={formAccessKey} /> : null}
        <div class="grid gap-4 sm:grid-cols-2">
          <label class="flex flex-col gap-2 text-sm text-foreground">
            Nombre
            <input
              class="field rounded-lg px-3 py-2 text-foreground transition"
              type="text"
              name="name"
              required
            />
          </label>
          <label class="flex flex-col gap-2 text-sm text-foreground">
            Email
            <input
              class="field rounded-lg px-3 py-2 text-foreground transition"
              type="email"
              name="email"
              required
            />
          </label>
        </div>
        <label class="flex flex-col gap-2 text-sm text-foreground">
          Tipo de proyecto
          <select
            class="field rounded-lg px-3 py-2 text-foreground transition"
            name="project"
            required
          >
            <option value="">Selecciona</option>
            <option value="shopify">Shopify / eCommerce</option>
            <option value="wordpress">WordPress / Headless</option>
            <option value="seo">SEO tecnico / Accesibilidad</option>
            <option value="automation">Automatizacion / Integraciones</option>
            <option value="otro">Otro</option>
          </select>
        </label>
        <label class="flex flex-col gap-2 text-sm text-foreground">
          Detalles y objetivos
          <textarea
            class="field min-h-[140px] rounded-lg px-3 py-2 text-foreground transition"
            name="message"
            required
          ></textarea>
        </label>
        <div class="rounded-lg border border-border/70 bg-panel p-3">
          <p class="text-xs uppercase tracking-[0.12em] text-muted">Verificacion</p>
          <div class="mt-2 flex flex-wrap items-center gap-3">
            <svg
              role="img"
              aria-label="Captcha: numero 57"
              width="96"
              height="48"
              viewBox="0 0 96 48"
              class="rounded-md border border-border/70 bg-panel-strong"
            >
              <rect x="0" y="0" width="96" height="48" fill="url(#grad-es)" />
              <text x="16" y="32" fill="currentColor" font-size="28" font-weight="700">57</text>
              <defs>
                <linearGradient id="grad-es" x1="0" x2="1" y1="0" y2="1">
                  <stop offset="0%" stop-color="#58a6ff" stop-opacity="0.16" />
                  <stop offset="100%" stop-color="#58a6ff" stop-opacity="0.06" />
                </linearGradient>
              </defs>
            </svg>
            <p class="text-sm text-muted">Escribe el numero para confirmar que eres humano.</p>
          </div>
          <label class="mt-3 block text-sm text-foreground">
            <span class="sr-only">Captcha</span>
            <input
              class="field rounded-lg px-3 py-2 text-foreground transition"
              type="text"
              name="captcha"
              inputmode="numeric"
              pattern="57"
              required
              aria-label="Captcha: escribe 57"
            />
          </label>
        </div>
        <button
          type="submit"
          class="inline-flex items-center justify-center rounded-full bg-accent px-4 py-2 text-sm font-semibold text-surface shadow-soft transition hover:bg-accent-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-surface"
        >
          Enviar formulario
        </button>
        <p class="mt-2 text-sm text-muted" data-form-status aria-live="polite"></p>
      </form>
    </div>

    <div class="mt-8 grid gap-4 sm:grid-cols-2">
      <div class="card p-5">
        <p class="text-xs uppercase tracking-[0.12em] text-muted">Email</p>
        <a class="text-foreground transition hover:text-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent" href={`mailto:${SITE.email}`}>
          {SITE.email}
        </a>
      </div>
      <div class="card p-5">
        <p class="text-xs uppercase tracking-[0.12em] text-muted">LinkedIn</p>
        <a class="text-foreground transition hover:text-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent" href={SITE.social.linkedin} target="_blank" rel="noopener">
          {SITE.social.linkedin}
        </a>
      </div>
      <div class="card p-5">
        <p class="text-xs uppercase tracking-[0.12em] text-muted">GitHub</p>
        <a class="text-foreground transition hover:text-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent" href={SITE.social.github} target="_blank" rel="noopener">
          {SITE.social.github}
        </a>
      </div>
      <div class="card p-5">
        <p class="text-xs uppercase tracking-[0.12em] text-muted">Telefono</p>
        <a class="text-foreground transition hover:text-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent" href={`tel:${SITE.phone.replace(/\s+/g, '')}`}>
          {SITE.phone}
        </a>
      </div>
    </div>

    <div class="mt-8 card p-5">
      <p class="text-xs uppercase tracking-[0.12em] text-accent">Disponibilidad</p>
      <p class="mt-2 text-muted">
        Proyectos de 4 a 12 semanas o acompañamiento continuo. Zona horaria: {SITE.location} (flexible para España y EE. UU.).
      </p>
    </div>
  </section>
  <script type="module" src={contactScript}></script>
</BaseLayout>

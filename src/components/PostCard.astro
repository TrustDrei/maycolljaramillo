---
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const formattedDate = new Date(post.data.date).toLocaleDateString(post.data.lang ?? 'es', {
  year: 'numeric',
  month: 'short',
  day: 'numeric'
});
const excerpt =
  post.data.excerpt.length > 140 ? `${post.data.excerpt.slice(0, 140).trim()}...` : post.data.excerpt;
const tagLabel = (() => {
  const lower = post.data.tags.map((t) => t.toLowerCase());
  if (lower.includes('checklist')) return post.data.lang === 'es' ? 'Checklist' : 'Checklist';
  if (lower.includes('cwv') || lower.includes('performance')) return post.data.lang === 'es' ? 'Guia' : 'Guide';
  if (lower.includes('seo') || lower.includes('accesibilidad')) return post.data.lang === 'es' ? 'Caso/Patron' : 'Pattern';
  return post.data.lang === 'es' ? 'Articulo' : 'Article';
})();
---
<article class="card flex h-full flex-col gap-3 p-5 lift-in">
  {post.data.hero && (
    <div
      class="overflow-hidden rounded-xl border border-border/70 bg-panel-strong"
      style={`aspect-ratio: ${post.data.hero.width}/${post.data.hero.height};`}
    >
      <img
        src={post.data.hero.src}
        alt={post.data.hero.alt}
        width={post.data.hero.width}
        height={post.data.hero.height}
        loading="lazy"
        decoding="async"
        class="h-full w-full object-cover"
      />
    </div>
  )}
  <div class="space-y-2">
    <span class="inline-flex items-center gap-2 rounded-full border border-border/60 bg-panel px-3 py-1 text-[11px] uppercase tracking-[0.18em] text-accent">{tagLabel}</span>
    <h3 class="text-lg font-semibold leading-snug text-foreground">{post.data.title}</h3>
  </div>
  <div class="flex flex-wrap gap-1.5">
    {post.data.tags.slice(0, 3).map((tag) => (
      <span class="rounded-full border border-border/60 bg-panel px-2.5 py-1 text-[11px] text-foreground/85">{tag}</span>
    ))}
  </div>
  <p class="text-sm leading-relaxed text-foreground/80">{excerpt}</p>
  <div class="mt-auto flex items-center justify-between gap-3 pt-2">
    <span class="text-xs text-muted">{formattedDate}</span>
    <a
      class="inline-flex items-center gap-2 rounded-full border border-border/70 bg-panel px-4 py-2 text-sm font-semibold text-foreground transition hover:-translate-y-[1px] hover:border-accent hover:text-foreground focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent"
      href={`/blog/${post.slug}`}
    >
      {post.data.lang === 'es' ? 'Leer' : 'Read'}
      <span aria-hidden="true">-&gt;</span>
    </a>
  </div>
</article>
